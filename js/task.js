function ctasksshowhide(){$("#cshowhide").click(function(){var e=$(".cshowhide").attr("src");if(e=="/images/plus.png"){$(".cshowhide").attr("src","/images/minus.png")}else{$(".cshowhide").attr("src","/images/plus.png")}$("#ctasksdiv").toggle("fast")})}function viewhandler(){$(".myview").each(function(){$(this).click(function(){var e=$(this).attr("id");var t=$("#selectedview").attr("data-code");if(t==e){return false}$(this).addClass("highview");$("#"+t).removeClass("highview");$("#selectedview").attr("data-code",e);loadview(0,e)})})}function loadview(e,t){if(document.getElementById("ctasks")){if(e==0){$("#tasks").empty()}}else{$("#body").empty();var n=$("<table id='tasks' cellpadding='2px' data-offset='0' data-limit='5'></table><div title='show more' class='more' id='more'>&nbsp;&nbsp;&nbsp;</div><br/><div id='cshowhide' style='padding:2px;'><img class='cshowhide' src='/images/plus.png' /><b class='tblhead' >Completed tasks</b><b>(</b><span class='ctc' id='ctcount'>0</span><b>)</b></div><div id='ctasksdiv'><table id='ctasks' cellpadding='2px' data-offset='0' data-limit='5'></table><div title='show more' class='more' id='cmore'>&nbsp;&nbsp;&nbsp;</div><br/><br/>");$("#body").append(n);showcmore($("#cmore"))}if(t=="view1"){showmore($("#more"))}else if(t=="view2"){showmore_d($("#more"))}else if(t=="view3"){showmore_c($("#more"))}else{}}function projectkey(){$("#iproject").on({focus:function(){$(this).val("");$(this).css("color","black")},keyup:function(e){if(e.which==13){var t=trim($("#iproject").val());if(t==""){flashmessage("Cannot add empty project.");return false}if(/[^a-z.-_ @A-Z0-9]/.test(t)){flashmessage("Project name not valid.");return false}$("#iproject").val("");addproject(t)}}});$(".projects").each(function(){$(this).click(function(){var e=$(this).attr("id");e=e.split("p").slice(1);var t=$("#projectid").val();showtasks(e[0])})})}function zerot(){if($(".zerot")){$(".zerot").each(function(){$(this).parent().parent().css("border-bottom","0px solid white");$(this).parent().parent().mouseover(function(){$(this).css("background-color","white")})})}}function htmlspecialchars(e,t,n,r){var i=0,s=0,o=false;if(typeof t==="undefined"||t===null){t=2}e=e.toString();if(r!==false){e=e.replace(/&/g,"&")}e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;");var u={ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4};if(t===0){o=true}if(typeof t!=="number"){t=[].concat(t);for(s=0;s<t.length;s++){if(u[t[s]]===0){o=true}else if(u[t[s]]){i=i|u[t[s]]}}t=i}if(t&u.ENT_HTML_QUOTE_SINGLE){e=e.replace(/'/g,"&#039;")}if(!o){e=e.replace(/"/g,"&quot;")}return e}function htmlspecialchars_decode(e,t){var n=0,r=0,i=false;if(typeof t==="undefined"){t=2}e=e.toString().replace(/&lt;/g,"<").replace(/&gt;/g,">");var s={ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4};if(t===0){i=true}if(typeof t!=="number"){t=[].concat(t);for(r=0;r<t.length;r++){if(s[t[r]]===0){i=true}else if(s[t[r]]){n=n|s[t[r]]}}t=n}if(t&s.ENT_HTML_QUOTE_SINGLE){e=e.replace(/&#0*39;/g,"'")}if(!i){e=e.replace(/&quot;/g,'"')}e=e.replace(/&/g,"&");return e}function flashmessage(e){$(this).empty();$("#ltd").show();$("#ltd").html(e);$("#ltd").fadeOut(5e3,function(){$(this).empty()})}function loading(e){if(e){$("#loading").show();$("#loading").html(loadimg)}else{$("#loading").hide()}}function saveuserprofile(){var e=$("input[name='username']").val();var t=$("input[name='upassword']").val();var n=$("input[name='password']").val();var r=$("input[name='cpassword']").val();$("#uerror").html("Processing..");if(e.length==0){}else if(e.length!=0&&/[^a-z.-_ @A-Z0-9]/.test(e)){$("#uerror").html("Username is invalid.");$("input[name='username']").addClass("highlight");setTimeout(function(){$("input[name='username']").removeClass("highlight")},1e3);return false}if(t.length!=0){if(t.length<6){$("#uerror").html("Password should be 6-15 chars.");$("input[name='upassword']").addClass("highlight");setTimeout(function(){$("input[name='upassword']").removeClass("highlight")},1e3);return false}if(n.length==0||n.length!=0&&n.length<6){$("#uerror").html("Password should be 6-15 chars.");$("input[name='password']").addClass("highlight");setTimeout(function(){$("input[name='password']").removeClass("highlight")},1e3);return false}if(r.length==0||r.length!=0&&r.length<6){$("#uerror").html("Password should be 6-15 chars.");$("input[name='cpassword']").addClass("highlight");setTimeout(function(){$("input[name='cpassword']").removeClass("highlight")},1e3);return false}if(n!=r){$("#uerror").html("Passwords didn't match.");$("input[name='npassword']").addClass("highlight");setTimeout(function(){$("input[name='npassword']").removeClass("highlight")},1e3);$("input[name='cpassword']").addClass("highlight");setTimeout(function(){$("input[name='cpassword']").removeClass("highlight")},1e3);return false}if(t==n){$("#uerror").html("Passwords are same.");return false}}var i=window.location.protocol+"//"+window.location.host+"/justdoit/userprofile";var s={username:e,cp:t,npass:n,cpass:r,jdi:$.cookie("jdi")};var o=sendrequest(i,s,false);if(typeof o=="object"&&o.ustatus=="success"){if(o.pstatus=="failed"&&o.perror!=""){$("#uerror").html(o.perror)}else{$("#uerror").html("User profile updated.");$("input[name='upassword']").val("");$("input[name='password']").val("");$("input[name='cpassword']").val("")}}else{if(o.ustatus=="failed"){$("#uerror").html(o.uerror)}}return true}function showtasks(e){var t=10;var n=0;$("#projectid").val(e);$("#selectedproject").html($("#p"+e).html());$("#tasks").empty();$("#tasks").attr("data-limit",t);$("#tasks").attr("data-offset",n);loadview(0,$("#selectedview").attr("data-code"))}function showmore(e){e.css({visibility:"hidden"});loading(1);var t=$("#fd").html();var n=$("#filteroptions").val();var r=$("#tasks").attr("data-limit");var i=$("#tasks").attr("data-offset");var s=$("#projectid").val();var o=$(".taskrow").length;r=parseInt(r);i=parseInt(o);task="task";var u=window.location.protocol+"//"+window.location.host+"/justdoit/fetch";var a={limit:r,offset:i,pid:s,duedate:n,jdi:$.cookie("jdi")};var f=sendrequest(u,a,false);if(typeof f=="object"&&f.status=="success"){$("#tcount").html(f.allrows);if(f.allrows>0){for(var l=0;l<f.tasks.length;l++){appendtotasks(f.tasks[l].task_id,f.tasks[l].task,f.tasks[l].priority,f.tasks[l].doby_date)}loading(0);if(f.allrows>r+i){e.css({visibility:"visible"})}$("#tasks").attr("data-limit",r);$("#tasks").attr("data-offset",i)}else{e.css({visibility:"hidden"});var c=document.getElementById("tasks").insertRow(0);var h=c.insertCell(0);h.innerHTML="<span class='zerot'>0 Tasks Found.</span>";loading(0);zerot()}}else{loading(0);flashmessage("Error occured.")}}function showmore_d(e){e.css({visibility:"hidden"});loading(1);var t=$("#fd").html();var n=$("#filteroptions").val();var r=$("#tasks").attr("data-limit");var i=$("#tasks").attr("data-offset");var s=$("#projectid").val();var o=$(".taskrow").length;r=parseInt(r);i=parseInt(o);task="task";var u=window.location.protocol+"//"+window.location.host+"/justdoit/fetch";var a={limit:r,offset:i,pid:s,duedate:n,jdi:$.cookie("jdi")};var f=sendrequest(u,a,false);if(typeof f=="object"&&f.status=="success"){$("#tcount").html(f.allrows);if(f.allrows>0){var l="";var c="";var h=document.getElementById("tasks");for(var p=0;p<f.tasks.length;p++){c=f.tasks[p].doby_date.split(" ").shift();if(l!=c){l=c;var d=l.split(".");var v=h.rows.length;var m=h.insertRow(v);var g=m.insertCell(0);var y=m.insertCell(1);var b=m.insertCell(2);var w=m.insertCell(3);var E=m.insertCell(4);m.setAttribute("class","daterow");g.setAttribute("class","taskstd1");y.setAttribute("class","taskstd2");b.setAttribute("class","taskstd3");w.setAttribute("class","taskstd4");E.setAttribute("class","taskstdmark");g.innerHTML="<span class='zerot'>&nbsp;</span>";y.innerHTML="<span class='colorrow' >"+d[0]+" "+mthNames[d[1]-1]+" "+d[2]+"</span>";b.innerHTML="<span>&nbsp;</span>";w.innerHTML="<span>&nbsp;</span>";E.innerHTML="<span>&nbsp;</span>"}appendtotasks(f.tasks[p].task_id,f.tasks[p].task,f.tasks[p].priority,f.tasks[p].doby_date)}loading(0);if(f.allrows>r+i){e.css({visibility:"visible"})}$("#tasks").attr("data-limit",r);$("#tasks").attr("data-offset",i)}else{e.css({visibility:"hidden"});var m=document.getElementById("tasks").insertRow(0);var g=m.insertCell(0);g.innerHTML="<span class='zerot'>0 Tasks Found.</span>";loading(0)}zerot()}else{loading(0);flashmessage("Error occured.")}}function showmore_c(e){e.css({visibility:"hidden"});loading(1);var t=$("#fd").html();var n=$("#filteroptions").val();var r=$("#tasks").attr("data-limit");var i=$("#tasks").attr("data-offset");var s=$("#projectid").val();var o=$(".taskrow").length;r=parseInt(r);i=parseInt(o);task="task";var u=window.location.protocol+"//"+window.location.host+"/justdoit/fetch";var a={limit:r,offset:i,pid:s,duedate:n,jdi:$.cookie("jdi")};var f=sendrequest(u,a,false);if(typeof f=="object"&&f.status=="success"){$("#tcount").html(f.allrows);if(f.allrows>0){var l=new Date;var c=l.getDate()+"."+l.getMonth()+"."+l.getFullYear();var h=new Date(l.getFullYear(),l.getMonth()+1,0);var p=h.getDate();var d=document.getElementById("tasks");var v=0;var m=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var g=d.insertRow(0);for(var y=0;y<5;y++){var b=g.insertCell(y);b.innerHTML="&nbsp;<b style='color:red;'>"+m[y]+"</b>&nbsp;"}for(var w=1;w<8;w++){var g=d.insertRow(w);for(var y=0;y<5;y++){++v;var b=g.insertCell(y);if(v==l.getDate()){b.innerHTML="&nbsp;<b style='color:red;'>"+v+"</b>&nbsp;"}else if(v>p){b.innerHTML="&nbsp;<b></b>&nbsp;"}else{b.innerHTML="&nbsp;<b>"+v+"</b>&nbsp;"}}}}else{e.css({visibility:"hidden"});var g=document.getElementById("tasks").insertRow(0);var E=g.insertCell(0);E.innerHTML="<span class='zerot'>0 Tasks Found.</span>";loading(0)}zerot()}else{loading(0);flashmessage("Error occured.")}}function showcmore(e){e.css({visibility:"hidden"});loading(1);var t=$("#ctasks").attr("data-limit");var n=$("#ctasks").attr("data-offset");var r=$(".ctaskrow").length;t=parseInt(t);n=parseInt(r);var i=window.location.protocol+"//"+window.location.host+"/justdoit/cfetch";var s={limit:t,offset:n,jdi:$.cookie("jdi")};$.ajax({async:true,url:i,error:function(e,t,n){ajaxresponse=false},success:function(r){if(typeof r=="object"){if(r.status=="success"){$("#ctcount").html(r.allrows);if(r.allrows>0){for(var i=0;i<r.tasks.length;i++){appendtoctasks(r.tasks[i].task_id,r.tasks[i].task,r.tasks[i].priority,r.tasks[i].doby_date,r.tasks[i].done_date)}if(r.allrows>t+n){e.css({visibility:"visible"});e.click(function(){showcmore($(this))})}$("#ctasks").attr("data-limit",t);$("#ctasks").attr("data-offset",n)}else{e.css({visibility:"hidden"});var s=document.getElementById("ctasks").insertRow(0);var o=s.insertCell(0);o.innerHTML="<span class='zerot'>0 Tasks Found.</span>";flashmessage("0 tasks found.");zerot()}}else{flashmessage(r.error)}loading(0)}},type:"POST",data:s,dataType:"json"})}function addproject(e){flashmessage("Processing..");var t=window.location.protocol+"//"+window.location.host+"/justdoit/project";var n={newproject:e,jdi:$.cookie("jdi")};var r=sendrequest(t,n,false);if(typeof r=="object"&&r.status=="success"){$("#projectfilter").append("<li><span class='projects' id='p"+r.id+"' >"+e+"</span><li>");projectkey();flashmessage("Project <i>"+e+"</i> added successfully.")}else{flashmessage(r.error)}}function taskcheck1(e,t,n){var r=document.getElementById(e).rowIndex;task=document.getElementById("tasktitle"+e).innerHTML;var i=window.location.protocol+"//"+window.location.host+"/justdoit/done";var s={id:e,jdi:$.cookie("jdi")};var o=sendrequest(i,s,false);if(typeof o=="object"&&o.status=="success"){addtotasks(e,r,task,t,n,1)}else{document.getElementById("error").innerHTML="Task update failed.";return false}return true}function taskcheck(e,t,n){flashmessage("Processing..");var r=e.parentNode.parentNode.rowIndex;taskid=e.parentNode.parentNode.id;task=document.getElementById("tasktitle"+taskid).innerHTML;var i=window.location.protocol+"//"+window.location.host+"/justdoit/done";var s={id:taskid,jdi:$.cookie("jdi")};var o=sendrequest(i,s,false);if(typeof o=="object"&&o.status=="success"){addtotasks(taskid,r,task,t,n,1)}else{flashmessage("Task update failed.");return false}flashmessage(" Task: '"+task.substr(0,10)+"..' completed.");return true}function undotask(e,t,n){flashmessage("Processing..");var r=e.parentNode.parentNode.rowIndex;taskid=e.parentNode.parentNode.id;task=document.getElementById("tasktitle"+taskid).innerHTML;var i={id:taskid,jdi:$.cookie("jdi")};var s=window.location.protocol+"//"+window.location.host+"/justdoit/undo";var o=sendrequest(s,i,false);if(typeof o=="object"&&o.status=="success"){var u=$("#projectid").val();if(u==o.pid){addtotasks(taskid,r,task,t,n,0)}else{var a="ctasks";var f=document.getElementById(a);f.deleteRow(r);var l=parseInt($("#ctcount").html());$("#ctcount").html(--l);if(f.rows.length==0){if(l==0){var c=f.insertRow(0);var h=c.insertCell(0);h.innerHTML="<span class='zerot'>0 Tasks Found.</span>";zerot()}else{showcmore($("#cmore"))}}}}else{flashmessage("Error occurred");return false}flashmessage(" Task: '"+task.substr(0,10)+"..' updated successfully.");return true}function addtotask(e,t,n,r,i,s){var o="tasks";var u=document.getElementById(o);var a=parseInt($("#tcount").html());$("#tcount").html(++a);if(u.rows[0].cells.length==1){u.deleteRow(0)}var f=u.insertRow(0);f.id=e;f.setAttribute("class","taskrow");var l=f.insertCell(0);var c=f.insertCell(1);var h=f.insertCell(2);var p=f.insertCell(3);var d=f.insertCell(4);l.setAttribute("class","taskstd1");c.setAttribute("class","taskstd2");h.setAttribute("class","taskstd3");p.setAttribute("class","taskstd4");d.setAttribute("class","taskstdmark");switch(r){case 1:p.innerHTML="<img src='/images/star_small_yellow.png'>";break;case 2:p.innerHTML="<img src='/images/star_small_red.png'>";break;default:}c.innerHTML="<div id='tasktitle"+e+"'>"+n+"</div>";if(i!="NA"){if(s==1){var v=new Date;var m=""+v.getDate()+"";if(m.length==1){m="0"+m}h.innerHTML=m+" "+mthNames[v.getMonth()]}else{h.innerHTML=i}}else{h.innerHTML=""}if(s==1){d.innerHTML="<div id='undomark' title='mark undone' alt='mark undone' onclick=\"undotask(this, "+r+", '"+i+"')\" /></div>"}else{d.innerHTML="<div id='domark' title='mark done' alt='mark done' onclick=\"taskcheck(this, "+r+", '"+i+"')\" /></div>"}setserial(u.id);cleartask();return true}function addtotasks(e,t,n,r,i,s){var o="ctasks";var u="tasks";if(s==1){var o="tasks";var u="ctasks"}var a=document.getElementById(u);var f=document.getElementById(o);if(t!=-1){f.deleteRow(t)}var l=parseInt($("#tcount").html());var c=parseInt($("#ctcount").html());if(o=="tasks"){$("#tcount").html(--l);$("#ctcount").html(++c)}else{$("#ctcount").html(--c);$("#tcount").html(++l)}if(f.rows.length==0){if(l==0||c==0){var h=f.insertRow(0);var p=h.insertCell(0);p.innerHTML="<span class='zerot'>0 Tasks Found.</span>";zerot()}else{if(o=="tasks"){showmore($("#more"))}else{showcmore($("#cmore"))}}}if(a.rows.length!=0&&a.rows[0].cells.length==1){a.deleteRow(0)}var h=a.insertRow(0);h.id=e;if(o=="tasks"){h.setAttribute("class","ctaskrow")}else{h.setAttribute("class","taskrow")}var p=h.insertCell(0);var d=h.insertCell(1);var v=h.insertCell(2);var m=h.insertCell(3);var g=h.insertCell(4);p.setAttribute("class","taskstd1");d.setAttribute("class","taskstd2");v.setAttribute("class","taskstd3");m.setAttribute("class","taskstd4");g.setAttribute("class","taskstdmark");switch(r){case 1:m.innerHTML="<img src='/images/star_small_yellow.png'>";break;case 2:m.innerHTML="<img src='/images/star_small_red.png'>";break;default:}d.innerHTML="<div id='tasktitle"+e+"'>"+n+"</div>";if(i!="NA"){if(s==1){var y=new Date;var b=""+y.getDate()+"";if(b.length==1){b="0"+b}v.innerHTML=b+" "+mthNames[y.getMonth()]}else{v.innerHTML=i}}else{v.innerHTML=""}if(s==1){g.innerHTML="<div id='undomark' title='mark undone' alt='mark undone' onclick=\"undotask(this, "+r+", '"+i+"')\" /></div>"}else{g.innerHTML="<div id='domark' title='mark done' alt='mark done' onclick=\"taskcheck(this, "+r+", '"+i+"')\" /></div>"}setserial(a.id);setserial(f.id);cleartask();return true}function appendtotasks(e,t,n,r){var i="tasks";n=parseInt(n);var s=r.split(".");var r=s[0]+" "+mthNames[s[1]-1]+"";var o=document.getElementById(i);if(o.rows.length!=0&&o.rows[0].cells.length==1){o.deleteRow(0)}var u=o.rows.length;var a=o.insertRow(u);a.id=e;a.setAttribute("class","taskrow");var f=a.insertCell(0);var l=a.insertCell(1);var c=a.insertCell(2);var h=a.insertCell(3);var p=a.insertCell(4);f.setAttribute("class","taskstd1");l.setAttribute("class","taskstd2");c.setAttribute("class","taskstd3");h.setAttribute("class","taskstd4");p.setAttribute("class","taskstdmark");switch(n){case 1:h.innerHTML="<img src='/images/star_small_yellow.png'>";break;case 2:h.innerHTML="<img src='/images/star_small_red.png'>";break;default:}l.innerHTML="<div id='tasktitle"+e+"'>"+t+"</div>";if(r!="NA"){c.innerHTML=r}else{c.innerHTML=""}p.innerHTML="<div id='domark' title='mark done' alt='mark done' onclick=\"taskcheck(this, "+n+", '"+r+"')\" /></div>";setserial(o.id);return true}function appendtoctasks(e,t,n,r,i){var s="ctasks";n=parseInt(n);var o=r.split(".");var r=o[0]+" "+mthNames[o[1]-1]+"";var u=i.split(".");var a=u[0]+" "+mthNames[u[1]-1]+"";var f=document.getElementById(s);var l=f.rows.length;var c=f.insertRow(l);c.id=e;c.setAttribute("class","ctaskrow");var h=c.insertCell(0);var p=c.insertCell(1);var d=c.insertCell(2);var v=c.insertCell(3);var m=c.insertCell(4);h.setAttribute("class","taskstd1");p.setAttribute("class","taskstd2");d.setAttribute("class","taskstd3");v.setAttribute("class","taskstd4");m.setAttribute("class","taskstdmark");switch(n){case 1:v.innerHTML="<img src='/images/star_small_yellow.png'>";break;case 2:v.innerHTML="<img src='/images/star_small_red.png'>";break;default:}p.innerHTML="<div id='tasktitle"+e+"'>"+t+"</div>";if(a!="NA"){d.innerHTML=a}else{d.innerHTML=""}m.innerHTML="<div id='undomark' title='mark undone' alt='mark undone' onClick=\"undotask(this, "+n+", '"+r+"')\" />";setserial(f.id);return true}function setserial(e){if(document.getElementById(e).rows[0].cells.length>1){$("div[id^='tasktitle']").each(function(){$("#"+this.id).click(function(){showtasknew(this)})})}}function showtasknew(e){if(currenttask==e.parentNode.parentNode.id){return true}if($("#tasktitle"+currenttask)){$("#tasktitle"+currenttask).removeClass("taskactive");$("#tasktitle"+currenttask).parent().parent().removeClass("rowactive")}currenttask=e.parentNode.parentNode.id;loading(1);$("#taskid").val(currenttask);var t=e.parentNode.parentNode;$("#th").html("Edit Task");$("#tasktitle"+currenttask).addClass("taskactive");$("#tasktitle"+currenttask).parent().parent().addClass("rowactive");var n=window.location.protocol+"//"+window.location.host+"/justdoit/get";var r={id:currenttask,jdi:$.cookie("jdi")};var i=sendrequest(n,r,false);if(typeof i=="object"&&i.error==""){var s=t.cells.length;$("#task").val(htmlspecialchars_decode(i.task,"ENT_QUOTES"));$("#description").val(htmlspecialchars_decode(i.description,"ENT_QUOTES"));var o=i.doby_date.split(".");var u=o[0]+" "+mthNames[o[1]-1]+" "+o[2];$("#datepick").val();$("#datelabel").html(u);if(i.priority==0){$("#taskstar").attr("src","/images/star_white.png")}else if(i.priority==1){$("#taskstar").attr("src","/images/star_yellow.png")}else{$("#taskstar").attr("src","/images/star_red.png")}$("#priority").val(i.priority);if(i.status==1){$("#tstatus").html('<img class="markdone" src="/images/done.png">')}else{var o=i.doby_date.split(".");var u=o[0]+" "+mthNames[o[1]-1]+"";$("#tstatus").html("<div id='taskmarkdone' title='mark done' alt='mark done'></div>");$("#taskmarkdone").click(function(){taskcheck1(currenttask,i.priority,u)})}$("#tstatus").parent().addClass("lborder");$("#created").html("Created on <var>"+i.since.substr(0,6)+"</var> ");$("#created").attr("title",i.since);if(i.done_date!=""){$("#lastupdate").html("Completed on <var>"+i.done_date.substr(0,6)+"</var> ");$("#lastupdate").attr("title",i.done_date)}else{$("#lastupdate").html("Updated on <var>"+i.last_updated_date.substr(0,6)+"</var> ");$("#lastupdate").attr("title",i.last_updated_date)}}else{loading(0);$("#error").html("Task not found");return false}loading(0);return true}function cleartask(){var e=new Date;if($("#tasktitle"+currenttask)){$("#tasktitle"+currenttask).removeClass("taskactive");$("#tasktitle"+currenttask).parent().parent().removeClass("rowactive")}currenttask=0;$("#th").html("Add Task");$("#error,#tstatus,#lastupdate,#created").empty();$("#task,#taskid,#description").val("");$("#priority").val(0);$("#datelabel").html(e.getDate()+" "+mthNames[e.getMonth()]+" "+e.getFullYear());$("#taskstar").attr("src","/images/star_white.png");$("#tstatus").parent().removeClass("lborder");$("#description").css("height","50px");$("#task").focus()}function trim(e){return e.replace(/^\s+|\s+$/g,"")}function validatejson(e){if(e.status==undefined||e.error==undefined||e.action==undefined){return false}return true}function savetask(){loading(1);$("#error").empty();var e=$("#taskid").val();var t=$("#projectid").val();var n=trim($("#task").val());var r=trim($("#description").val());var i=$("#datelabel").html();var s=parseInt($("#priority").val());var o="";if(n==""){o="Task is empty";$("#error").html(o);$("#task").focus();$("#task").addClass("highlight");setTimeout(function(){$("#task").removeClass("highlight")},1e3);setTimeout(function(){$("#error").empty()},2e3);loading(0);return false}var u=i.split(" ");if(u.length==3){var a=new Date;i=i+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()}var f=u[0]+" "+u[1];if($("#edit"+e)){$("#edit"+e).empty()}var l="id="+e+"&pid="+t+"&t="+encodeURIComponent(n)+"&td="+encodeURIComponent(r)+"&tde="+i+"&tp="+s+"&jdi="+$.cookie("jdi")+"";var c=window.location.protocol+"//"+window.location.host+"/justdoit/save";var h=sendrequest(c,l,false);if(typeof h!="object"){$("#error").html("Error occured.");loading(0);return false}if(!validatejson(h)){$("#error").html("Error occured.");loading(0);return false}if(h.status=="success"&&h.action=="insert"){addtotask(h.taskid,-1,n,s,f,0);flashmessage(" Task: <i>'"+n.substr(0,10)+"..'</i> added successfully. ")}else if(h.status=="success"&&h.action=="update"){tro=document.getElementById(""+h.taskid+"");var p="";switch(s){case 1:p="<img src='/images/star_small_yellow.png'>";break;case 2:p="<img src='/images/star_small_red.png'>";break;default:}var d=document.getElementById(h.taskid).getElementsByTagName("td");d[1].innerHTML="<div id='tasktitle"+h.taskid+"'>"+n+"</div>";if(h.taskstatus==0){d[2].innerHTML=f}else{var v="";if(h.done_date!=""){var m=h.done_date.split(".");v=m[0]+" "+mthNames[m[1]-1]+""}d[2].innerHTML=v}d[3].innerHTML=p;if(h.taskstatus==0){d[4].innerHTML="<div id='domark' title='mark done' alt='mark done' onclick=\"taskcheck(this, "+s+", '"+f+"')\" />&nbsp;&nbsp;&nbsp;</a>"}else if(h.taskstatus==1){d[4].innerHTML="<div id='undomark' title='mark undone' alt='mark undone' onClick=\"undotask(this, "+s+", '"+f+"')\" />"}if(h.taskstatus==0){setserial("tasks")}else if(h.taskstatus==1){setserial("ctasks")}else{}flashmessage(" Task: <i>'"+n.substr(0,10)+"..'</i> updated successfully. ");cleartask()}else if(h.status=="success"){$("#error").empty();cleartask()}else{$("#error").html(h.error)}loading(0);return true}function sendrequest(e,t,n){var r;$.ajax({async:n,url:e,error:function(e,t,n){r=false},success:function(e){r=e},type:"POST",data:t,dataType:"json"});return r}function getlocaldate(e){var t=new Date;var n=t.getTime();var r=0;switch(e){case"tommorrow":n=n+24*60*60*1e3;var i=new Date(n);r=i.getDate()+" "+mthNames[i.getMonth()]+" "+i.getFullYear();break;case"EOW":var s=t.getDay();n=n+(6-s)*24*60*60*1e3;var i=new Date(n);r=i.getDate()+" "+mthNames[i.getMonth()]+" "+i.getFullYear();break;case"week":n=n+7*24*60*60*1e3;var i=new Date(n);r=i.getDate()+" "+mthNames[i.getMonth()]+" "+i.getFullYear();break;default:}return r}var currenttask=0;var requestHash="";var mthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var loaders=["m.gif","m1.gif"];var r=Math.floor(Math.random()*2);var loadimg="<img src='/images/loading.gif'>";var formedit=false;var datepickr=function(){function e(e,n){var r="",i=new Date(e),o={d:function(){var e=o.j();return e<10?"0"+e:e},D:function(){return m[o.w()].substring(0,3)},j:function(){return i.getDate()},l:function(){return m[o.w()]+"day"},S:function(){return b[o.j()]||"th"},w:function(){return i.getDay()},F:function(){return s(o.n(),true)},m:function(){var e=o.n()+1;return e<10?"0"+e:e},M:function(){return s(o.n(),false)},n:function(){return i.getMonth()},Y:function(){return i.getFullYear()},y:function(){return o.Y().toString().substring(2,4)}},u=n.split("");t(u,function(e){r+=o[e]?o[e]():e});return r}function t(e,t){var n=0,r=e.length;for(n;n<r;n++){if(t(e[n],n)===false){break}}}function n(e,t,n){if(e.addEventListener){e.addEventListener(t,n,false)}else if(e.attachEvent){var r=function(t){t=t||window.event;t.preventDefault=function(e){return function(){e.returnValue=false}}(t);t.stopPropagation=function(e){return function(){e.cancelBubble=true}}(t);t.target=t.srcElement;n.call(e,t)};e.attachEvent("on"+t,r)}}function r(e,t,n){if(e.removeEventListener){e.removeEventListener(t,n,false)}else if(e.detachEvent){e.detachEvent("on"+t,n)}}function i(e,t,n){var r;if(!(e in w)){w[e]=document.createElement(e)}r=w[e].cloneNode(false);if(t!=null){for(var i in t){r[i]=t[i]}}if(n!=null){if(typeof n=="object"){r.appendChild(n)}else{r.innerHTML=n}}return r}function s(e,t){return t==true?g[e]:g[e].length>3?g[e].substring(0,3):g[e]}function o(e,t,n){return e==v.current.day()&&t==v.current.month.integer()&&n==v.current.year()}function u(){var e=document.createDocumentFragment();t(m,function(t){e.appendChild(i("th",{},t.substring(0,2)))});return e}function a(){while(this.calendarBody.hasChildNodes()){this.calendarBody.removeChild(this.calendarBody.lastChild)}var e=(new Date(this.currentYearView,this.currentMonthView,1)).getDay(),t=v.month.numDays(this.currentMonthView,this.currentYearView);this.currentMonth.innerHTML=v.month.string(this.config.fullCurrentMonth,this.currentMonthView)+" "+this.currentYearView;this.calendarBody.appendChild(c(e,t,this.currentMonthView,this.currentYearView))}function f(e,t,n){return i("span",{className:"current-month"},v.month.string(e.fullCurrentMonth,t)+" "+n)}function l(e,t,n){var r=i("div",{className:"months"}),s=i("span",{className:"prev-month"},i("span",{className:"prevMonth"},"&lt;")),o=i("span",{className:"next-month"},i("span",{className:"nextMonth"},"&gt;"));r.appendChild(s);r.appendChild(o);return r}function c(e,t,n,r){var s=document.createDocumentFragment(),u=i("tr"),a=0,f;for(f=1;f<=e;f++){u.appendChild(i("td",null,"&nbsp;"));a++}for(f=1;f<=t;f++){if(a==7){s.appendChild(u);u=i("tr");a=0}var l=o(f,n,r)?{className:"today"}:null;u.appendChild(i("td",l,i("span",{className:"day"},f)));a++}for(f=1;f<=7-a;f++){u.appendChild(i("td",null,"&nbsp;"))}s.appendChild(u);return s}function h(){var e=(new Date(this.currentYearView,this.currentMonthView,1)).getDay(),t=v.month.numDays(this.currentMonthView,this.currentYearView),r=this;var s=inputTop=0,o=this.element;if(o.offsetParent){do{s+=o.offsetLeft;inputTop+=o.offsetTop}while(o=o.offsetParent)}var a=i("div",{className:"calendar"});a.style.cssText="display: none; position: absolute; top: "+(inputTop+this.element.offsetHeight)+"px; left: "+s+"px; z-index: 100;";this.currentMonth=f(this.config,this.currentMonthView,this.currentYearView);var h=l(this.config,this.currentMonthView,this.currentYearView);h.appendChild(this.currentMonth);var p=i("table",null,i("thead",null,i("tr",{className:"weekdays"},u())));this.calendarBody=i("tbody");this.calendarBody.appendChild(c(e,t,this.currentMonthView,this.currentYearView));p.appendChild(this.calendarBody);a.appendChild(h);a.appendChild(p);document.body.appendChild(a);n(a,"click",function(e){E.calendarClick.call(r,e)});return a}var p=[],d=new Date,v={current:{year:function(){return d.getFullYear()},month:{integer:function(){return d.getMonth()},string:function(e){var t=d.getMonth();return s(t,e)}},day:function(){return d.getDate()}},month:{string:function(e,t){var n=t;return s(n,e)},numDays:function(e,t){return e==1&&!(t&3)&&(t%100||!(t%400))?29:y[e]}}},m=["Sun","Mon","Tues","Wednes","Thurs","Fri","Satur"],g=["January","February","March","April","May","June","July","August","September","October","November","December"],y=[31,28,31,30,31,30,31,31,30,31,30,31],b={1:"st",2:"nd",3:"rd",21:"st",22:"nd",23:"rd",31:"st"},w=[],E={calendarClick:function(t){if(t.target.className){switch(t.target.className){case"prev-month":case"prevMonth":this.currentMonthView--;if(this.currentMonthView<0){this.currentYearView--;this.currentMonthView=11}a.call(this);break;case"next-month":case"nextMonth":this.currentMonthView++;if(this.currentMonthView>11){this.currentYearView++;this.currentMonthView=0}a.call(this);break;case"day":document.getElementById("datelabel").innerHTML=e((new Date(this.currentYearView,this.currentMonthView,t.target.innerHTML)).getTime(),this.config.dateFormat);var n=new Date;document.getElementById("datelabel").innerHTML=document.getElementById("datelabel").innerHTML+" "+n.getHours()+":"+n.getMinutes()+":"+n.getSeconds();this.close();break}}},documentClick:function(e){if(e.target!=this.element&&e.target!=this.calendar){var t=e.target.parentNode;if(t!=this.calender){while(t!=this.calendar){t=t.parentNode;if(t==null){this.close();break}}}}}};return function(e,i){var s=this;this.element=document.getElementById(e);this.config={fullCurrentMonth:true,dateFormat:"F jS, Y"};this.currentYearView=v.current.year();this.currentMonthView=v.current.month.integer();if(i){for(var o in i){if(this.config.hasOwnProperty(o)){this.config[o]=i[o]}}}this.documentClick=function(e){E.documentClick.call(s,e)};this.open=function(e){n(document,"click",s.documentClick);t(p,function(e){if(e!=s){e.close()}});s.calendar.style.display="block"};this.close=function(){r(document,"click",s.documentClick);s.calendar.style.display="none"};this.calendar=h.call(this);p.push(this);if(this.element.nodeName=="INPUT"){n(this.element,"focus",this.open)}else{n(this.element,"click",this.open)}}}();$(document).ready(function(){function n(){$("input[name='upassword']").val("");$("input[name='password']").val("");$("input[name='cpassword']").val("");$("#uerror").empty();$("#popup_box").fadeOut("slow")}function r(){$("#uerror").empty();$("#popup_box").fadeIn("slow")}var e=$(window).height()-90;$("#body").css("height",""+e+"px");$("#container").css("height",""+e+"px");$("#taskbar").css("height",""+e+"px");$("#antibox").css("height",""+e+"px");viewhandler();$("#view1").click();cleartask();var t=new Date;$("ltd").html(t.getDate()+" "+mthNames[t.getMonth()]+" "+t.getFullYear());$("#datelabel").html(t.getDate()+" "+mthNames[t.getMonth()]+" "+t.getFullYear()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds());$("div[id^='tasktitle']").each(function(){$("#"+this.id).click(function(){showtasknew(this)})});if($("#fd").html()==""){$("#fd").parent().width("5%")}$("#filterselect").change(function(){$("#filteroptions").val($("#filterselect option:selected").val());$("#filterselect").prop("selectedIndex",0);$("#filterbydate").submit()});$("#taskstar").click(function(){var e=$("#taskstar").attr("src");var e=e.split("/");var t=e.pop();var n=e.join("/");var r=["star_white.png","star_yellow.png","star_red.png"];var i=r.indexOf(t);if(i==r.length-1){n=n+"/"+r[0];$("#priority").val(0)}else{n=n+"/"+r[i+1];$("#priority").val(i+1)}$("#taskstar").attr("src",n)});$("#description").keyup(function(){$(this).css("height","1px");$(this).css("height",""+(25+this.scrollHeight)+"px")});$("#task").on("keyup",function(e){if(e.which==13){savetask()}});$("#tsave").click(function(){savetask()});if(requestHash==""){requestHash=$("#hash").attr("data-code");if(requestHash==""){window.location.reload()}}$("#taskfilter").append("<li><span class='fildate' id='tommorrow' data-date='"+getlocaldate("tommorrow")+"'>By Tommorrow</span><li>");$("#taskfilter").append("<li><span class='fildate' id='eow' data-date='"+getlocaldate("EOW")+"'>By End of Week</span><li>");$("#taskfilter").append("<li><span class='fildate' id='week' data-date='"+getlocaldate("week")+"'>In a Week</span><li>");$("#taskfilter").append("<li><span class='fildate' id='all' data-date='all'>All Tasks</span><li>");$(".fildate").each(function(){$(this).click(function(){var e=$(this).attr("data-date");$("#filteroptions").val(e);if(e=="all"){$("#fd").html("&nbsp;")}else{$("#fd").html("Due date:"+$(this).attr("data-date")+"")}var t=$("#projectid").val();showtasks(t)})});if($("#task")){$("#task").focus()}zerot();if($("#more")){$("#more").click(function(){loadview(1,$("#selectedview").attr("data-code"))})}if($("#cmore")){$("#cmore").click(function(){showcmore($(this))})}new datepickr("datepick",{dateFormat:"d M Y"});$("#iduserprofile").click(function(){r()});$("#popupBoxClose").click(function(){n()});$("#container").click(function(){n()});$("#isave").click(function(){saveuserprofile()});$("#icancel").click(function(){n()});$(function(){scroller=$(".box-wrap").antiscroll().data("antiscroll")});projectkey();ctasksshowhide()})